## 一些上机示例
1. 基础设施是经济社会发展的重要支撑，基础设施建设是国民经济基础性、先导性、战略性、引领性产业。现在需要我们设计一个小型的基建项目管理系统，通过把工程项目、供应商和原材料信息有机的结合起来（每个供应商只供应一种原材料），从而提高项目的实施效率。系统至少应该包含几个核心模块：项目管理模块、供应商管理模块、原材料管理模块、供需管理模块。  
1）项目管理模块：用于记录项目的基本信息，包括项目编号、名称、地址、起始时间、项目状态等等；  
2）供应商管理模块：用于记录供应商的基本信息，包括供应商代码、名称、供应原材料代码等等；  
3）原材料管理模块：用于记录原材料的基本信息，包括原材料代码、名称、类别、单价、存放地、库存数等等；  
4）供需管理模块：用于记录项目供需的基本信息，包括项目编号、供应商代码、原材料代码、供应数量等等。  
- 用SQL语句创建表格，包括主外键；其中项目编号必须是12个字符长度，并且以’PJNO’开始。例如，‘PJNO00000001’。
```sql
CREATE TABLE 项目管理(
  项目编号  VARCHAR(12) PRIMARY KEY CHECK(项目编号 LIKE 'PJNO%'),
  项目名称  VARCHAR(50),
  地址      VARCHAR(50),
  开始时间  DATE,
  项目状态  VARCHAR(5) CHECK(项目状态 IN ("未开始","施工中","已交付")))；
CREATE TABLE 供应商管理(
  供应商代码  VARCHAR(10),
  名称       VARCHAR(100),
  供应原材料代码  NUMERIC(20),
  PRIMARY KRY (供应商代码));
CREATE TABLE 原材料管理(
  原材料代码  NUMERIC(20) PRIMARY KEY,
  原材料名称  VARCHAR(40) NOT NULL,
  原材料类别  VARCHAR(40),
  单价       DECIMAL(5,2),
  存放地     VARCHAR(100),
  库存数     INT);
CREATE TABLE 供需管理(
  供需记录编号  NUMERIC(20),
  项目编号      VARCHAR(13),
  供应商代码    VARCHAR(10),
  原材料代码    NUMERIC(20),
  供应数量      INT NOT NULL,
  FOREIGN KEY (项目编号) REFERENCES 项目管理(项目编号),
  FOREIGN KEY (供应商代码) REFERENCES 供应商管理(供应商代码),
  FOREIGN KEY (原材料代码) REFERENCES 原材料管理(原材料代码));
```
- 查询各种状态下的项目数量，项目状态为：未开始、施工中、已交付
```sql

```  
- 创建一个视图，显示供应数量最多的原材料信息  
```sql
CREATE VIEW 最多供应数 AS
SELECT 原材料管理.原材料代码,原材料管理.原材料名称,原材料管理.原材料类别,原材料管理.单价,原材料管理.存放地,SUM(供应数量) AS 总供给数
FROM 供需管理
JOIN 原材料管理 ON 供需管理.原材料代码=原材料管理.原材料代码
GROUP BY 原材料管理.原材料代码,原材料管理.原材料名称,原材料管理.原材料类别,原材料管理.单价,原材料管理.存放地
ORDER BY 总供给数 DESC;
```
- 查询项目名包含“南京”的项目所有供需信息  
```sql
SELECT 项目管理.项目编号,项目管理.项目名称,供需管理.供应商代码,供需管理.原材料代码,供需管理.供应数量
FROM 项目管理
JOIN 供需管理 ON 项目管理.项目编号=供需管理.项目编号
WHERE 项目管理.项目名称 LIKE '%南京'；
```
- 查询至少需要3种不同原材料且每种原材料的供应数量不低于10的项目编号与名称  
```sql
SELECT 项目管理.项目编号,项目管理.项目名称
FROM 项目管理
JOIN 供需管理 ON 项目管理.项目编号=供需管理.项目编号
WHERE 供需管理.供应数量>=10
GROUP BY 项目管理.项目编号,项目管理.项目名称
HAVING COUNT(DISTINCT 供需管理.原材料代码)>=3;
```
- 查询使用了“原材料A”但没有使用“原材料B”的项目编号和名称  
```sql
SELECT 项目管理.项目编号,项目管理.项目名称
FROM 项目管理
JOIN 供需管理 ON 项目管理.项目编号=供需管理.项目编号
JOIN 原材料管理 ON 供需管理.原材料代码=原材料管理.原材料代码
WHERE 原材料管理.原材料名称='原材料A'
AND 项目管理.项目编号 NOT IN(
  SELECT 项目编号
  FROM 供需管理
  WHERE 原材料名称='原材料B');
```


2. 电子商务是指以信息网络技术为手段，以商品交换为中心的商务活动；买卖双方不谋面地进行各种商贸活动，实现消费者的网上购物、商户之间的网上交易和在线电子支付以及各种商务活动、交易活动、金融活动和相关的综合服务活动的一种新型的商业运营模式。现在需要我们设计一个小型的电子商务系统。系统至少应该包含几个核心模块：用户管理模块、商品管理模块、订单管理模块、购物车管理模块、供应商管理模块。  
1）用户管理模块：用于记录用户的基本信息，包括用户名、密码、电话等等；  
2）商品管理模块：用于记录销售的商品信息，包括商品名称、商品描述、商品分类、供货商等等；  
3）订单管理模块：用于记录用户订购商品的信息，包括用户姓名、电话、地址、商品名、订单状态等等；  
4）购物车管理模块：用于记录用户购物已选但未支付的商品；  
5）供应商管理模块：用于记录供应商信息，包括供应商名称、联系人、电话、营业执照等等。
```sql
--用户管理表
CREATE TABLE users (
    user_id NUMBER PRIMARY KEY,
    username VARCHAR2(50) NOT NULL,
    password VARCHAR2(50) NOT NULL,
    phone VARCHAR2(15)
);
--供应商管理表
CREATE TABLE suppliers (
    supplier_id NUMBER PRIMARY KEY,
    supplier_name VARCHAR2(100) NOT NULL,
    contact_name VARCHAR2(50),
    phone VARCHAR2(15),
    license VARCHAR2(50)
);
--商品管理表
CREATE TABLE products (
    product_id NUMBER PRIMARY KEY,
    product_name VARCHAR2(100) NOT NULL,
    product_description VARCHAR2(255),
    category VARCHAR2(50),
    supplier_id NUMBER REFERENCES suppliers(supplier_id)
);
--订单管理表
CREATE TABLE orders (
    order_id NUMBER PRIMARY KEY,
    user_id NUMBER REFERENCES users(user_id),
    product_id NUMBER REFERENCES products(product_id),
    order_status VARCHAR2(20),
    user_name VARCHAR2(50),
    phone VARCHAR2(15),
    address VARCHAR2(255)
);
--购物车管理表
CREATE TABLE cart (
    cart_id NUMBER PRIMARY KEY,
    user_id NUMBER REFERENCES users(user_id),
    product_id NUMBER REFERENCES products(product_id),
    added_time DATE DEFAULT SYSDATE
);
```
- 创建一个存储过程，输入商品名称（模糊）能打印“共找到XXX个供应商提供XXX商品!”，如果未找到，那么打印“没有供应商提供XXX商品”。
```sql
CREATE OR REPLACE PROCEDURE find_suppliers(product_name_pattern VARCHAR2) 
IS
    supplier_count NUMBER;
BEGIN
    SELECT COUNT(DISTINCT supplier_id)
    INTO supplier_count
    FROM products
    WHERE LOWER(product_name) LIKE LOWER('%' || product_name_pattern || '%');
    
    IF supplier_count > 0 THEN
        DBMS_OUTPUT.PUT_LINE('共找到' || supplier_count || '个供应商提供' || product_name_pattern || '商品!');
    ELSE
        DBMS_OUTPUT.PUT_LINE('没有供应商提供' || product_name_pattern || '商品。');
    END IF;
END;
```
- 创建一个存储过程，查询用户购物车商品信息，并按商品添加时间降序排列。
```sql
CREATE OR REPLACE PROCEDURE query_cart_info(user_id_in NUMBER) 
IS
BEGIN
    FOR rec IN (
        SELECT c.cart_id, p.product_name, c.added_time
        FROM cart c
        JOIN products p ON c.product_id = p.product_id
        WHERE c.user_id = user_id_in
        ORDER BY c.added_time DESC
    ) LOOP
        DBMS_OUTPUT.PUT_LINE('购物车编号: ' || rec.cart_id || ', 商品名称: ' || rec.product_name || ', 添加时间: ' || rec.added_time);
    END LOOP;
END;
```
- 在用户表上建立一个触发器，当删除用户信息时，删除用户所有订单信息和购物车信息。
```sql
CREATE OR REPLACE TRIGGER delete_user_dependents
AFTER DELETE ON users
FOR EACH ROW
BEGIN
    DELETE FROM orders WHERE user_id = :OLD.user_id;
    DELETE FROM cart WHERE user_id = :OLD.user_id;
END;
```